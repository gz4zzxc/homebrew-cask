---
alwaysApply: true
description: 提交信息与 GitHub Actions 工作流规范
---

## 提交信息与 CI 工作流

### 提交信息（版本更新）

推荐使用以下提交信息模板：

```text
chore: update {App Name} to version {version}

- Updated version from {old_version} to {new_version}
- Updated SHA256 checksum
- Updated README.md version table
- Source: {official_source_url}
```

**注意**：若为复合版本（如 `25.7.1,1178`），提交标题与 README 显示仅使用主版本号 `25.7.1`。

### GitHub Actions 工作流规范

#### 基本配置

- **文件名**：`update-{app-name}.yml`
- **Workflow 名称**：`Update {App Name} Cask`
- **定时任务**：每日北京时间 07:00–09:00（Cron：避开整点、分散错峰）
- **权限最小化**：`contents: write`，其余按需
- **并发与互斥**：使用 `concurrency` 防止并发冲突

#### 推荐工作流结构

```yaml
name: Update {App Name} Cask
on:
  schedule:
    - cron: "12 23 * * *"  # 北京时间 07:12
  workflow_dispatch: {}

permissions:
  contents: write

concurrency:
  group: update-{app-name}
  cancel-in-progress: true

jobs:
  update:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check new version
        id: check
        run: |
          # 输出：new_version, new_sha256, update_needed
          echo "new_version=..." >> $GITHUB_OUTPUT
          echo "new_sha256=..." >> $GITHUB_OUTPUT
          echo "update_needed=true" >> $GITHUB_OUTPUT

      - name: Apply updates
        if: steps.check.outputs.update_needed == 'true'
        run: |
          NEW_VERSION=${{ steps.check.outputs.new_version }}
          NEW_SHA256=${{ steps.check.outputs.new_sha256 }}
          # 更新 cask 文件
          sed -i '' "s/^\s*version \".*\"/  version \"$NEW_VERSION\"/" Casks/{app-name}.rb
          sed -i '' "s/^\s*sha256 \".*\"/  sha256 \"$NEW_SHA256\"/" Casks/{app-name}.rb || true
          # README 仅显示主版本
          NEW_VERSION_DISPLAY=$(echo "$NEW_VERSION" | cut -d',' -f1)
          sed -i '' "s/| \`{cask-name}\` | [^|]* |/| \`{cask-name}\` | $NEW_VERSION_DISPLAY |/" README.md

      - name: Validate
        if: steps.check.outputs.update_needed == 'true'
        run: |
          ruby -c Casks/{app-name}.rb
          grep "\`{cask-name}\`" README.md

      - name: Commit and push
        if: steps.check.outputs.update_needed == 'true'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add Casks/{app-name}.rb README.md
          git commit -m "chore: update {App Name} to version ${{ steps.check.outputs.new_version }}\n\n- Updated version from previous to ${{ steps.check.outputs.new_version }}\n- Updated SHA256 checksum\n- Updated README.md version table\n- Source: {official-website}"
          git push
```

### 更多细节

更多细节参见：[CONTRIBUTING.md](mdc:CONTRIBUTING.md)

