---
globs: Casks/*.rb
description: livecheck 策略与下载链接校验（verified/user_agent/referer）
---

## livecheck 与下载链接校验

### livecheck 优先级

1. Sparkle Feed（`strategy :sparkle, &:short_version`）
2. 上游稳定发布页 / XML / JSON（使用 `regex` 抽取）
3. GitHub Releases（如上游托管在 GitHub）
4. 下载页解析（仅当稳定可解析时）

示例：

```ruby
livecheck do
  url "https://static.eudic.net/pkg/eudic_mac.xml"
  strategy :sparkle, &:short_version
end
```

或：

```ruby
livecheck do
  url "https://www.sony.com/electronics/support/articles/CCCT03000"
  regex(/Catalyst\s+Browse\s+(\d+(?:\.\d+)+)/i)
end
```

### 复合版本处理

`version` 若为 `x.y.z,build`，下载链接可用 `version.csv.first/second` 片段；README 仅显示主版本（见「版本同步与自动化更新」）。

### 下载链接校验

- 优先添加 `verified: "domain/"`，确保来源可信。
- 仅在确需时添加 `user_agent: :fake` 或 `referer:`，避免无谓依赖。
- 优先上游主域名；避免不必要的镜像与重定向。
- 如有多架构，配合 `arch` 与分架构 `sha256`，确保插值正确：

```ruby
arch arm: "-arm64"
sha256 arm: "...", intel: "..."
url "https://cdn.example.com/App-#{version}#{arch}.dmg", verified: "cdn.example.com/"
```

### 其他

- 若应用具备自更新能力，请声明 `auto_updates true`。
- `depends_on macos:` 指定合理的最低系统版本，避免模糊表述。

